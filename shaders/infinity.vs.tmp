uniform mat4 MatrixP;
uniform mat4 MatrixV;
uniform mat4 MatrixW;

attribute vec4 POS2D_UV;

varying vec3 PS_TEXCOORD;
varying vec3 PS_POS;

void main()
{
    vec3 POSITION = vec3(POS2D_UV.xy, 0);
    float samplerIndex = floor(POS2D_UV.z/2.0);
    vec3 TEXCOORD0 = vec3(POS2D_UV.z - 2.0*samplerIndex, POS2D_UV.w, samplerIndex);

    vec3 object_pos = POSITION.xyz;
    vec4 world_pos = MatrixW * vec4( object_pos, 1.0 );

    mat4 mtxPV = MatrixP * MatrixV;
    gl_Position = mtxPV * world_pos;

    PS_TEXCOORD = TEXCOORD0;
    PS_POS = world_pos.xyz;
}